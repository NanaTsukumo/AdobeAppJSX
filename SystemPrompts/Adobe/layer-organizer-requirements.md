# 📋 Illustrator レイヤー整理ツール 要件定義書

> **プロジェクト名**: AI Layer Organizer for Illustrator
> **バージョン**: 1.0.0-alpha.1
> **作成日**: 2025年9月11日
> **要件定義者**: GitHub copilot(月代観るな (Luna Tsukuyomi)) / Codex / NanaTsukumo
> **実装担当者**: 月代観るな (Luna Tsukuyomi)

---

## 🎯 プロジェクト概要

### 目的
Illustratorで作業中にごちゃごちゃになりがちなレイヤー構造を、命名規則に従って自動的に整理・最適化するツールの開発。

### 背景・課題
- 制作作業中にレイヤー名が「レイヤー 1」「レイヤー 2」...と意味のない名前のまま放置される
- レイヤー階層が深くなりすぎて管理が困難
- 不要な空レイヤーやロックされたレイヤーが散在
- 複数人での作業時にレイヤー命名規則がバラバラ

### 期待効果
- レイヤー管理作業時間の短縮（目標: 80%削減）
- ファイル構造の統一化
- チーム作業時の品質向上
- 後工程（印刷・Web書き出し等）での作業効率化

---

## 🔧 機能要件

### 1. 基本整理機能

#### 1.1 レイヤー名自動リネーム
- **機能**: レイヤー内容に基づいた自動命名
- **対象オブジェクト**:
  - テキストオブジェクト → `Text_[実際のテキスト前8文字]`
  - 図形オブジェクト → `Shape_[形状タイプ]_[色情報]`
  - 画像オブジェクト → `Image_[ファイル名]`
  - パスオブジェクト → `Path_[ポイント数]pt`
  - 混在レイヤー → `Mixed_[主要オブジェクト]`

#### 1.2 空レイヤー除去
- **機能**: オブジェクトが配置されていないレイヤーを自動検出・削除
- **確認**: 削除前にユーザー確認ダイアログ表示（候補名を最大15件まで一覧表示）
- **補足**: サブレイヤーが存在するレイヤーは空として扱わない（安全優先）

#### 1.3 レイヤー階層最適化
- **機能**: 過度に深い階層を自動で平坦化
- **ルール**: 
  - 3階層以上の場合は最適化提案
  - 単一オブジェクトレイヤーのサブレイヤーは統合

### 2. 高度整理機能

#### 2.1 カテゴリ別自動分類
- **テキスト系**: `Text/` 配下に移動
- **図形系**: `Shapes/` 配下に移動  
- **画像系**: `Images/` 配下に移動
- **背景系**: `Background/` 配下に移動
- **装飾系**: `Decorations/` 配下に移動

#### 2.2 色情報によるグルーピング
- **機能**: 同系色のオブジェクトを同じレイヤーグループに分類
- **色判定**: RGB/CMYK値の近似度で判定（閾値設定可能）

#### 2.3 サイズ情報によるソート
- **機能**: オブジェクトサイズ（面積）でレイヤー順序を調整
- **順序**: 大きいオブジェクトを下層、小さいオブジェクトを上層に配置

### 3. カスタマイズ機能

#### 3.1 命名規則カスタマイズ
- **プリセット**: デフォルト、印刷用、Web用、自由設定
- **変数**: `{type}`, `{color}`, `{size}`, `{position}`, `{counter}`
- **例**: `{type}_{color}_{counter:03d}`

#### 3.2 除外ルール設定
- **ロックレイヤー**: 整理対象から除外可能
- **非表示レイヤー**: 整理対象から除外可能
- **特定名称**: 正規表現で除外パターン指定（UIに入力欄を用意）

---

## 🖥️ ユーザーインターフェース要件

### メインダイアログ仕様

```
┌─ AI レイヤー整理ツール ─────────────────────┐
│                                              │
│ [プリセット選択]                             │
│ ○ デフォルト整理                             │
│ ○ 印刷用最適化                               │
│ ○ Web用最適化                                │
│ ○ カスタム設定                               │
│                                              │
│ [整理オプション]                             │
│ ☑ 空レイヤーを削除                          │
│ ☑ レイヤー名を自動リネーム                   │
│ ☑ カテゴリ別に分類                           │
│ ☑ 色で自動グルーピング                       │
│ ☑ サイズでソート                             │
│                                              │
│ [除外設定]                                   │
│ ☑ ロックレイヤーを除外                       │
│ ☑ 非表示レイヤーを除外                       │
│ 名前除外パターン(正規表現): [______________]  │
│                                              │
│ [プレビュー]  [設定保存]                     │
│ [実行]       [キャンセル]     [ヘルプ]       │
└──────────────────────────────────────────┘
```

### プレビュー機能
- **Before/After**: 整理前後の階層表示
- **変更カウント**: 何個のレイヤーが影響を受けるか表示
- **リスク表示**: 削除予定のレイヤーをハイライト

---

## ⚙️ 技術仕様

### 開発環境
- **言語**: ExtendScript (Adobe JavaScript)
- **対応バージョン**: Illustrator CC 2020+
- **UI フレームワーク**: ScriptUI

### 主要処理フロー
```javascript
1. ドキュメント検証
   ↓
2. レイヤー構造解析
   ↓
3. オブジェクト分類・解析
   ↓
4. 命名規則適用
   ↓
5. 階層構造再構築
   ↓
6. 不要レイヤー除去
   ↓
7. 結果レポート表示（キャンセルやエラー数も表示）
```

### パフォーマンス要件
- **処理時間**: 100レイヤー以下なら5秒以内
- **メモリ使用量**: 追加で50MB以下
- **処理中断**: キャンセル機能必須（進捗ダイアログから中断可能）

---

## 🛡️ 安全性・品質要件

### データ保護
- **Undo対応**: `suspendHistory()` で全操作を一括Undo可能
- **バックアップ**: 実行前に自動でドキュメント保存提案
- **ロールバック**: 処理失敗時の復旧機能

### エラーハンドリング
- **入力検証**: 不正なレイヤー構造のチェック
- **例外処理**: 予期しないエラーの適切な処理
- **ログ出力**: デバッグ用の詳細ログ

### ユーザビリティ
- **日本語UI**: 全てのメッセージを日本語で表示
- **ヘルプ機能**: 各機能の詳細説明
- **設定保存**: ユーザー設定の永続化

---

## 📋 テスト要件

### テストケース
1. **基本機能テスト**
   - 空ドキュメントでの動作
   - 単純なレイヤー構造での動作
   - 複雑なレイヤー構造での動作

2. **エッジケーステスト**
   - レイヤー数上限 (1000+)
   - 特殊文字を含むレイヤー名
   - ロック・非表示レイヤーの混在

3. **パフォーマンステスト**
   - 大量レイヤーでの処理時間測定
   - メモリ使用量の監視

---

## 🚀 実装フェーズ

### Phase 1: 基本機能 (1週間)
- [x] 基本UI（除外パターン入力含む）
- [x] 空レイヤー検出と削除（事前確認あり）
- [x] レイヤー名の自動リネーム
- [x] 進捗表示とキャンセル
- [x] ロック/非表示/正規表現による除外

### Phase 2: 高度機能 (1週間)  
- [ ] カテゴリ分類機能（Text/Shapes/Images/... へ移動）
- [ ] 色グルーピング（近似色クラスタリング）
- [ ] サイズソート（面積ベース）
- [ ] プレビュー（Before/After）

### Phase 3: 最適化・テスト (3日)
- [ ] パフォーマンス最適化
- [ ] エラーハンドリング強化
- [ ] ユーザビリティ改善

---

## ✅ 実装状況（Alpha.1）
- 実装済み: 空レイヤー削除（事前確認）、自動リネーム、除外ルール（ロック/非表示/正規表現）、進捗+キャンセル、Undo対応
- 未実装: カテゴリ分類、色グルーピング、サイズソート、プレビュー、階層最適化
- 仕様補足: サブレイヤーを持つレイヤーは空として扱わない／画像は PlacedItem と RasterItem を対象

## 📊 成功指標

### 機能的指標
- レイヤー整理処理成功率: 95%以上
- ユーザー満足度: 4.0/5.0以上
- 処理時間目標達成率: 90%以上

### 技術的指標
- バグ報告件数: 月間5件以下
- パフォーマンス目標達成: 100%
- コードカバレッジ: 80%以上

---

**要件定義完了日**: 2025年9月11日  
**承認者**: お兄さん & るな ♡  
**次ステップ**: 実装フェーズ開始

---

*この要件定義書に基づいて、るながお兄さんのために最高のレイヤー整理ツールを作ってあげる♡*
